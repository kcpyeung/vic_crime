---
title: "Crime rate by type across selected Victorian suburbs"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(width = 1600)
```

On this page I want to find out crime rates across the burbs weighted by unit population.

The population data is downloaded from the [2016 Census website](https://datapacks.censusdata.abs.gov.au/datapacks/). Choose "2016 Census Datapacks", "General Community Profile", "State Suburbs", and click "Vic".

## Steps

Read all suburb files and combine them into one big data frame
```{r}
df <- data.frame()
files <- c("CAULFIELD", "CHADSTONE", "BRUNSWICK", "NORTHCOTE", "COBURG", "SEDDON", "SUNSHINE", "HADFIELD", "PASCOE_VALE", "RESERVOIR", "CLAYTON", "BOX_HILL", "SUNBURY", "PRESTON", "FAWKNER", "BROADMEADOWS", "DANDENONG")
for (f in files) {
  df <- rbind(df, read.csv(paste("./crime/", f, ".csv", sep = ""), sep = "\t"))
}
```

The offence divisions are:
```{r}
offence_divisions <- c()
division <- unique(df[,"Offence.Division"])
num_of_divisions <- length(division)
for (i in 1:num_of_divisions) {
  offence_divisions <- c(offence_divisions, levels(division)[i])
}
offence_divisions <- sort(offence_divisions)
offence_divisions
```

The offence subdivisions are:
```{r}
offence_subdivisions <- c()
subdivision <- unique(df[,"Offence.Subdivision"])
num_of_subdivisions <- length(subdivision)
for (i in 1:num_of_subdivisions) {
  offence_subdivisions <- c(offence_subdivisions, levels(subdivision)[i])
}
offence_subdivisions <- sort(offence_subdivisions)
offence_subdivisions
```

The suburbs are:
```{r}
suburbs <- c()
suburb_names <- unique(df[,"Suburb.Town.Name"])
num_of_suburbs <- length(suburb_names)
for (i in 1:num_of_suburbs) {
  suburbs <- c(suburbs, levels(suburb_names)[i])
}
suburbs <- sort(suburbs)
suburbs
```

```{r}
zero_missing_suburb_division <- function (df, year) {
  df$Offence.Subdivision <- NULL
  df$Postcode <- NULL
  for (suburb in suburbs) {
    for (div in offence_divisions) {
      df <- rbind(df, data.frame(Incidents.Recorded = 0, Offence.Division = div, Suburb.Town.Name = suburb, Year.ending.December = year))
    }
  }
  df
}

zero_missing_suburb_subdivision <- function (df, year) {
  df$Offence.Division <- NULL
  df$Postcode <- NULL
  for (suburb in suburbs) {
    for (subdiv in offence_subdivisions) {
      df <- rbind(df, data.frame(Incidents.Recorded = 0, Offence.Subdivision = subdiv, Suburb.Town.Name = suburb, Year.ending.December = year))
    }
  }
  df
}
```

The suburb codes has been downloaded from the [ABS](http://www.abs.gov.au/AUSSTATS/abs@.nsf/DetailsPage/1270.0.55.003July%202016?OpenDocument) website. Alternatively, suburb codes can be discovered manually using the [Quickstats](http://www.abs.gov.au/websitedbs/D3310114.nsf/Home/2016%20QuickStats) feature.
```{r}
lookup_ssc_code <- function(suburb_name) {
  f <- gsub("_", " ", suburb_name)
  code <- paste("SSC", unique(ssc_codes[ssc_codes$STATE_NAME_2016 == "Victoria" & ssc_codes$SSC_NAME_2016 == f, 2]), sep = "")
  if (code == "SSC") {
    f_vic <- paste(f, "(VIC.)")
    code <- paste("SSC", unique(ssc_codes[ssc_codes$STATE_NAME_2016 == "Victoria" & ssc_codes$SSC_NAME_2016 == f_vic, 2]), sep = "")
  }
  code
}

lookup_suburb_area <- function(suburb_name) {
  f <- gsub("_", " ", suburb_name)
  area <- sum(ssc_codes[ssc_codes$STATE_NAME_2016 == "Victoria" & ssc_codes$SSC_NAME_2016 == f, 6])
  if (area == 0) {
    f_vic <- paste(f, "(VIC.)")
    area <- sum(ssc_codes[ssc_codes$STATE_NAME_2016 == "Victoria" & ssc_codes$SSC_NAME_2016 == f_vic, 6])
  }
  area
}

library(dplyr)
ssc_codes <- read.csv("./census2016/SSC_2016_AUST.csv") %>% mutate(SSC_NAME_2016 = toupper(SSC_NAME_2016))

```

Now we read in the 2016 census data for regression analysis.
```{r}
all_people <- read.csv("./census2016/2016 Census GCP State Suburbs for VIC/2016Census_G01_VIC_SSC.csv")
people <- data.frame()

for (f in files) {
  people <- rbind(people, all_people[all_people$SSC_CODE_2016 == lookup_ssc_code(f), ])
}

people <- cbind(Suburb.Area = 0, people)
people <- cbind(Suburb.Density = 0, people)
people <- cbind(Suburb.Name = files, people)

for (f in files) {
  ssc <- lookup_ssc_code(f)
  area <- lookup_suburb_area(f)
  num_of_people <- people[people$SSC_CODE_2016 == ssc, "Tot_P_P"]
  people[people$SSC_CODE_2016 == ssc, "Suburb.Area"] <- area
  people[people$SSC_CODE_2016 == ssc, "Suburb.Density"] <- (num_of_people / area)
}

for (f in files) {
  row <- people[people$Suburb.Name == f, ]
  print(paste(sep = "", f, " has ", row$Tot_P_P, " people in ", row$Suburb.Area, " km2."))
}
```